---
title: "Descriptive Statistics of Survey WSS Operators Brazil"
date: "Last run: `r format(Sys.time(), '%B %e, %Y')`"
output: 
  html_document:
    code_folding: hide
    pandoc_args:
      - "--default-image-extension=png"
bibliography: BR_WaterSurvey.bib
---




```{r SETUP, message=FALSE, warning=FALSE, include=FALSE }
# BELLO   https://holtzy.github.io/Pimp-my-rmd/#references
# https://stackoverflow.com/questions/43549930/pdf-figures-not-shown-in-html-files-produced-by-rmarkdown-when-open-with-firefox
# to fix issue of picture not rendering TRY 
# devtools::install_github('yihui/knitr')

knitr::opts_chunk$set(fig.retina = 2, # ensure crisp display on retina screens but will double the physical size of your images. 
                      tidy.opts = list(width.cutoff = 120),  # For code
                      options(width = 120) # For output
							 )  

#  The encoding ("ISO-8859-1") is not UTF-8. We will only support UTF-8 in the future. Please re-save your file "sample.Rmd" with the UTF-8 encoding.

# To generate tables using summarytool s own html rendering, the .Rmd document s configuration part (yaml) must point to the package s summarytools.css file.
```

```{r LOADPCK, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(stringr)
library(forcats)
library(scales)
library(patchwork)
library(countrycode)
library(sf)
library(here)
library(kableExtra)
library(summarytools)
library(pander)
```


```{r COPYOUTPimage, message=FALSE, include=FALSE}
# # OKKIO, I am in /DataMEX, because it contains a file `.here`, BUT WHEN I COMPILE THE SITE I AM IN /DataMEX/MEXwatersurvey
# library(here)
# here::dr_here(show_reason = T)
# 
# from_dir <- here::here("07_output")
# to_dir <- here::here("BrazilWaterSurvey", "output")
# 
# files <- list.files(path = from_dir , full.names = TRUE) #,  pattern = ".png$" )
# move <- files[sapply(files, file.size) < 100000000] # < 100 MB or Github will get stuck
# 
# # --- SYNTAX
# # file.copy(list.of.files, new.folder)
# 
# file.copy( move, to = to_dir , overwrite = T )
# # if I had listed with full.names = F
# # file.copy( file.path(from_dir, move), to = to_dir  )
```

```{r COPYOUTPdata, message=FALSE, include=FALSE}
# library(here)
# here::dr_here(show_reason = T)
# 
# from_dir2 <- here::here("03_cleandata")
# to_dir2 <- here::here("BrazilWaterSurvey", "data")
# 
# files2 <- list.files(path = from_dir2 , full.names = TRUE, pattern =  ".*\\.Rdata$")  # pattern =  "(^oper|^pres|^Census).*\\.Rdata$") 
# move2 <- files2[sapply(files2, file.size) < 100000000] # < 100 MB or Github will get stuck
# 
# # --- SYNTAX
# # file.copy(list.of.files, new.folder)
# file.copy( move2, to = to_dir2 , overwrite = T )
```



## Descriptive Statistics of Survey WSS Operators Brazil

In observing the survey outcomes, I will try comparing across potential relevant features:

+ **ownership/type** and 
+ **size** 
+ (possibly **prevalence of urban vs rural coverage vs**)
+ (**Age**?)
+ (supply mix **W/S/W+S**)
+ **State** ? 


Here is a very basic distribution of our sampled Suppliers in Brazil, by STATE (UF), Ownership Type and size of Coverage reach

```{r tblcov, results="asis", warning=FALSE}
load(here::here("output", "tbl_uf_own_cov.Rdata"))
# class(tbl_uf_own_cov)
caption <- "Sampled Suppliers in Brazil, by STATE (UF), Ownership Type and size of Coverage reach"
covtable <- pandoc.table.return(tbl_uf_own_cov, 
										  keep.line.breaks = F, 
                                 style = "multiline", 
 										  justify = "lcrr", 
										  caption = caption
										  )

cat(covtable)
```

##  Legislative Context

1. Overall, it seems that the majority of the Suppliers declare they operate in a context where there is legislation for key operational aspects such as:
	+ Coverage Areas
	+ Service 
	+ Quality
	+ Tariffs 
	
	
<center>
![Plot_CountByLawOwnersh.png](./output/Plot_CountByRango.png "Plot_CountByRango.png")
</center>

<center>
![Plot_CountByLawOwnersh.png](./output/Plot_CountByLawOwnersh.png "Plot_CountByLawOwnersh.png")
</center>


## 1) COVERAGE

### Summary of key coverage numeric variable 

As of `r format(Sys.time(), '%B %e, %Y')`, the WSS suppliers in the sample cover an average of *85 municipios* (almost always in one State), corresponding to a mean *covered population of 2,596,772*. The suppliers on average serve localities that are *84% urban*. 


```{r tbldescstatcov, results="asis", warning=FALSE}
load(here::here("output", "tbl_descstat_cov.Rdata"))
# class(tbl_descstat_cov)

caption <- "Summary of Coverage variables"
var.summary <- pandoc.table.return(tbl_descstat_cov , 
											   keep.line.breaks = TRUE,
											  round = 2,
											  big.mark = ",",
											  justify = "llrrrrrr", # OKKIO AL # DI COLONNE
											  caption = caption, style = "multiline",
											   split.table = Inf
											  )

cat(var.summary)
```


### Area(s) covered vs. service

> Is there any difference between the Product MIX { Q9a_d_Mix_comb} vs the URB-RUR MIX of the supplier {Q4_UrbRur_Mix}[^1] 

[^1]: Later on, I would like to explore if  _(?) Is the urbanization process (size, local distribution, rate) causing the lack (access, quality, affordability ) to service in the region (controlling for physical assets / hydrological condition, pop #,  etc) ? ??_

> (?) Is the urbanization process (size, local distribution, rate) causing the lack (access, quality, affordability ) to service in the region (controlling for physical assets / hydrological condition, pop #,  etc) ? ??

### Summary of key key service charateristics  

the WSS suppliers in the sample as of `r format(Sys.time(), '%B %e, %Y')`,  ...

```{r tbldescstatcovserv, results="asis", warning=FALSE}
load(here::here("output", "tbl_descstat_covserv.Rdata"))
# class(tbl_descstat_cov)

caption <- "Summary of Service variables"
var.summary <- pandoc.table.return(tbl_descstat_covserv , 
											   keep.line.breaks = TRUE,
											  round = 2,
											  big.mark = ",",
											  justify = "llrrrrrr", # OKKIO AL # DI COLONNE
											  caption = caption, style = "multiline",
											   split.table = Inf
											  )

cat(var.summary)
```



### Zooming in on some interesting COV aspects 


> ...


### NRW / Efficiency

> Lit Input: NRW. 
The key determinants of high NRW are: 
1) the cost of implementing counter-measures 
2) a political cost associated with the control of unauthorized consumption in marginalized ares 
3) a cost to those people who benefit from corruption 
4) technical cost of shortening leakage detection time & improving pressure management (especially when the cost of pumping more raw water is 0 or low) [see @gonzalez-gomez_why_2011, pp. 33-35;  ch. 1].


Y + Efficiency = Q13m3fatt / Q12m3INSystem
X + Exist procedim for estimation of vol loss/ (Q24)
	+ Q39 leaks detection
	+ Q40 network inspected %
	+ Q42 cland connections analyzed
> (?) Is the year of operation anywhere connected with efficiency?  
> (?) Is thestack of laws connected with efficiency (Expected inverse relation)?? `Q8a_c_Leg_comb`  `Q8a_LegInst_Cover` `Q8b_LegInst_DirServ` "`Q8c_LegInst_DirQual` `Q8d_LegInst_Tarif`", 
 


### Reliability of the service
> Lit Input: Performance can improve with: 
1) carefully designed private sector participation in service provision 
2) regulatory agencies that are transparent, accountable, and free of political interference, 
3) strong accountability mechanisms for SOE. [see @andres_uncovering_2013 ].

Y + Reliability = Q4... Q45 interruptions 
X + location 
	+ size 
	+ age? Q6
	+ Quality regulation (q8c)
	+ SWIT penetration ? 
	+ % eng in staff
	+ % IT in staff? 

> Lit Input: Energy consumption much of O&M costs [see @lackey_energy_2017] 

## 2) SWIT
	



## 3) CORPORATE GOVERNANCE 

Y + Index of regulation (Q8a....Q8d) cumulative
	+ 

## 4) FINANCE 

## 5) TARIFFS

## REFERENCE


