---
title: "Descriptive Statistics of Survey WSS Operators Brazil"
date: "Last run: `r format(Sys.time(), '%B %e, %Y')`"
output: 
  html_document:
    code_folding: hide
    pandoc_args:
      - "--default-image-extension=png"
---




```{r SETUP, message=FALSE, warning=FALSE, include=FALSE }
# BELLO   https://holtzy.github.io/Pimp-my-rmd/#references
# https://stackoverflow.com/questions/43549930/pdf-figures-not-shown-in-html-files-produced-by-rmarkdown-when-open-with-firefox
# to fix issue of picture not rendering TRY 
# devtools::install_github('yihui/knitr')

knitr::opts_chunk$set(fig.retina = 2, # ensure crisp display on retina screens but will double the physical size of your images. 
                      tidy.opts = list(width.cutoff = 120),  # For code
                      options(width = 120) # For output
							 )  

#  The encoding ("ISO-8859-1") is not UTF-8. We will only support UTF-8 in the future. Please re-save your file "sample.Rmd" with the UTF-8 encoding.

# To generate tables using summarytool s own html rendering, the .Rmd document s configuration part (yaml) must point to the package s summarytools.css file.
```

```{r LOADPCK, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(stringr)
library(forcats)
library(scales)
library(patchwork)
library(countrycode)
library(sf)
library(here)
library(kableExtra)
library(summarytools)
library(pander)
```


```{r COPYOUTPimage, message=FALSE, include=FALSE}
# OKKIO, I am in /DataMEX, because it contains a file `.here`, BUT WHEN I COMPILE THE SITE I AM IN /DataMEX/MEXwatersurvey
library(here)
here::dr_here(show_reason = T)

from_dir <- here::here("07_output")
to_dir <- here::here("BrazilWaterSurvey", "output")

files <- list.files(path = from_dir , full.names = TRUE) #,  pattern = ".png$" )
move <- files[sapply(files, file.size) < 100000000] # < 100 MB or Github will get stuck

# --- SYNTAX
# file.copy(list.of.files, new.folder)

file.copy( move, to = to_dir , overwrite = T )
# if I had listed with full.names = F
# file.copy( file.path(from_dir, move), to = to_dir  )
```

```{r COPYOUTPdata, message=FALSE, include=FALSE}
library(here)
here::dr_here(show_reason = T)

from_dir2 <- here::here("03_cleandata")
to_dir2 <- here::here("BrazilWaterSurvey", "data")

files2 <- list.files(path = from_dir2 , full.names = TRUE, pattern =  ".*\\.Rdata$")  # pattern =  "(^oper|^pres|^Census).*\\.Rdata$") 
move2 <- files2[sapply(files2, file.size) < 100000000] # < 100 MB or Github will get stuck

# --- SYNTAX
# file.copy(list.of.files, new.folder)
file.copy( move2, to = to_dir2 , overwrite = T )
```



# Descriptive Statistics of Survey WSS Operators Brazil

In observing the survey outcomes, I will try comparing across potential relevant features:

+ **ownership/type** and 
+ **size** 
+ (possibly **prevalence of urban vs rural coverage vs**)
+ (**Age**?)
+ (supply mix **W/S/W+S**)
+ **State** ? 


Here is a very basic distribution of our sampled Suppliers in Brazil, by STATE (UF), Ownership Type and size of Coverage reach

```{r tblcov, results="asis", warning=FALSE}
load(here::here("output", "tbl_uf_own_cov.Rdata"))
# class(tbl_uf_own_cov)
caption <- "Sampled Suppliers in Brazil, by STATE (UF), Ownership Type and size of Coverage reach"
covtable <- pandoc.table.return(tbl_uf_own_cov, 
										  keep.line.breaks = F, 
                                 style = "multiline", 
 										  justify = "lcrr", 
										  caption = caption
										  )

cat(covtable)
```


## 1) COVERAGE

### Summary of key coverage numeric variable 

As of `r format(Sys.time(), '%B %e, %Y')`, the WSS suppliers in the sample cover an average of *85 municipios* (almost always in one State), corresponding to a mean *covered populaiton of 2,236,483*. The suppliers on average serve localities that are *84% urban*. 


```{r tbldescstatcov, results="asis", warning=FALSE}
load(here::here("output", "tbl_descstat_cov.Rdata"))
class(tbl_descstat_cov)

caption <- "Summary of Coverage variables"
var.summary <- pandoc.table.return(tbl_descstat_cov , 
											   keep.line.breaks = TRUE,
											  round = 2,
											  big.mark = ",",
											  justify = "llrrrrrr", # OKKIO AL # DI COLONNE
											  caption = caption, style = "multiline",
											   split.table = Inf
											  )

cat(var.summary)
```


### Area(s) 

> (?) Is the urbanization process (size, local distribution, rate) causing the lack (access, quality, affordability ) to service in the region (controlling for physical assets / hydrological condition, pop #,  etc) ? ??


### Zooming in on some interesting COV aspects 

> ...
 


### Efficiency/Reliability of the service

Y + Efficiency = Q13m3fatt / Q12m3INSystem
X + Exist procedim for estimation of vol loss/ (Q24)
	+ Q39 leaks detection
	+ Q40 network inspected %
	+ Q42 cland connections analyzed
> (?) Is the year of operation anywhere connected with efficiency?  

Y + Reliability = Q4... Q45 interruptions 
X + location 
	+ size 
	+ age? Q6
	+ Quality regulation (q8c)
	+ SWIT penetration ? 
	+ % eng in staff
	+ % IT in staff? 

## 5) SWIT
	



## 2) CORPORATE GOVERNANCE 

Y + Index of regulation (Q8a....Q8d) cumulative
	+ 

## 3) FINANCE 

## 4) TARIFFS


